<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.messanger.mapper.GoalMapper">

    <resultMap id="GoalMap" type="com.project.messanger.dto.GoalDto">
        <id property="goalIdx" column="goal_idx"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="status" column="status"/>
        <result property="targetValue" column="targetValue"/>
        <result property="currentValue" column="currentValue"/>
        <result property="startDate" column="startDate"/>
        <result property="endDate" column="endDate"/>
        <result property="creatorIdx" column="creator_idx"/>
        <result property="createdDate" column="created_date"/>
        <result property="updatedDate" column="updated_date"/>
    </resultMap>

    <insert id="insertGoal" parameterType="com.project.messanger.dto.GoalDto" useGeneratedKeys="true" keyProperty="goalIdx" keyColumn="goal_idx">
        INSERT goal
        SET title = #{title},
            target_value = #{targetValue},
            current_value = #{currentValue},
            creator_idx = #{creatorIdx},
            <choose>
                <when test="status != null"> status = #{status},</when>
                <otherwise> status = 'WAIT',</otherwise>
            </choose>
            <if test="description != null"> description = #{description},</if>
            <if test="startDate != null"> start_date = #{startDate},</if>
            <if test="endDate != null"> end_date = #{endDate},</if>
            created_date = NOW(),
            updated_date = NOW()
    </insert>

    <update id="updateGoal" parameterType="com.project.messanger.dto.GoalDto">
        UPDATE goal
        SET title = #{title},
            target_value = #{targetValue},
            current_value = #{currentValue},
            <if test="status != null">status = #{status},</if>
            <if test="description != null"> description = #{description},</if>
            <if test="startDate != null"> start_date = #{startDate},</if>
            <if test="endDate != null"> end_date = #{endDate},</if>
            updated_date = NOW()
        WHERE goal_idx = #{goalIdx}
    </update>

    <delete id="deleteGoal" parameterType="long">
        DELETE FROM goal
        WHERE goal_idx = #{goalIdx}
    </delete>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.messanger.mapper.NoticeMapper">

    <resultMap id="ReportMap" type="com.project.messanger.dto.ReportDto">
        <id property="reportIdx" column="report_idx"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="type" column="type"/>
        <result property="approverIdx" column="approver_idx"/>
        <result property="creatorIdx" column="creator_idx"/>
        <result property="createdDate" column="created_date"/>
        <result property="updatedDate" column="updated_date"/>
    </resultMap>

    <select id="getReportList" parameterType="hashmap" resultMap="ReportMap">
        SELECT *
        FROM report
        <where>
            <if test="title != null">
                AND UPPER(title) LIKE CONCAT('%', UPPER(#{title}), '%')
            </if>
        </where>
        ORDER BY report_idx DESC
        LIMIT ${limit} OFFSET ${offset}
    </select>
    
    <select id="getReportByIdx" parameterType="long" resultMap="ReportMap">
        SELECT *
        FROM report
        WHERE report_idx = #{reportIdx}
    </select>

    <insert id="insertReport" parameterType="com.project.messanger.dto.ReportDto">
        INSERT report
        SET title = #{title},
            <if test="description != null"> description = #{description},</if>
            type = #{type}
            <if test="approverIdx"> approver_idx = #{approverIdx},</if>
            user_idx = #{userIdx}
            created_date = NOW(),
            updated_date = NOW()
    </insert>

    <update id="updateReport" parameterType="com.project.messanger.dto.ReportDto">
        UPDATE report
        SET title = #{title},
            <if test="description != null"> description = #{description},</if>
            <if test="approverIdx != null"> approver_idx = #{approverIdx},</if>
            updated_date = NOW()
        WHERE report_idx = #{reportIdx}
    </update>

    <delete id="deleteReport" parameterType="long">
        DELETE FROM report
        WHERE report_idx = #{reportIdx}
    </delete>

</mapper>